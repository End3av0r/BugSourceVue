/*
 * @Descripttion: 
 * @Author: Enthusi4sm
 * @version: 
 * @Date: 2025-09-24 23:52:35
 * @LastEditors: Enthusi4sm
 * @LastEditTime: 2025-09-25 02:25:15
 * @function: 
 */
import axios from 'axios'

const API_URL = 'http://localhost:8091/api'

// 获取最新漏洞信息
export function getLatestVulnerabilities(limit, offset) {
  return axios.get(`${API_URL}/vuln/latest`, {
    params: { limit, offset }
  })
}

// 按条件查询漏洞信息
export function searchVulnerabilities(params) {
  return axios.post(`${API_URL}/vuln/query`, params)
}

// 按ID查询漏洞详情
export function getVulnerabilityById(id) {
  return axios.get(`${API_URL}/vuln/queryId`, {
    params: { id }
  })
}

// 按时间范围查询漏洞信息
export function getVulnerabilitiesByDateRange(startDate, endDate) {
  return axios.post(`${API_URL}/vuln/queryDate`, {
    startDate,
    endDate
  })
}

// 获取每日新增漏洞统计数据
export function getDailyVulnerabilityStats() {
  // 这里假设后端有提供此接口，如果没有，前端可以通过处理queryDate接口返回的数据来实现
  const today = new Date()
  const thirtyDaysAgo = new Date()
  thirtyDaysAgo.setDate(today.getDate() - 30)

  return getVulnerabilitiesByDateRange(
    thirtyDaysAgo.toISOString().split('T')[0],
    today.toISOString().split('T')[0]
  )
}

// 获取各类型漏洞统计数据
export function getVulnerabilityTypeStats() {
  // 这里假设后端有提供此接口，如果没有，前端可以通过处理query接口返回的数据来实现
  return searchVulnerabilities({
    limit: 1000,
    offset: 0
  })
}

/**
 * 新增：获取近 days 天的每日新增漏洞统计
 * @param {number} days - 需要查询的天数
 * @returns {Promise} - Axios Promise
 */
export function getDailyNewVuln(days) {
  return axios.get(`${API_URL}/vuln/daily_count`, {
    params: { days }
  })
}

/**
 * 新增：获取近 months 个月的每月新增漏洞统计
 * @param {number} months - 需要查询的月数，默认为12
 * @returns {Promise} - Axios Promise
 */
export function getMonthlyNewVuln(months = 12) {
  return axios.get(`${API_URL}/vuln/monthly_count`, {
    params: { months }
  })
}

/**
 * 新增：获取各威胁程度（危害等级）漏洞的统计数据
 * @returns {Promise} - Axios Promise
 */
export function getVulnerabilityHazardStats() {
  return axios.get(`${API_URL}/vuln/type_count`);
}

/**
 * 新增：获取各漏洞类型的数量统计
 * @returns {Promise} - Axios Promise
 */
export function getVulnerabilityTypeCount() {
  return axios.get(`${API_URL}/vuln/level_count`);
}

/**
 * 大模型解析markdown漏洞信息
 * @param {string} markdown - 需要解析的markdown文本
 * @returns {Promise} - Axios Promise
 */
export function parseMarkdownWithAI(markdown) {
  return axios.post(`${API_URL}/vuln/upload_markdown`, {
    markdown: markdown
  })
}

/**
 * 添加漏洞标签
 * @param {number} vulnId - 漏洞ID
 * @param {string} tag - 标签内容
 * @returns {Promise} - Axios Promise
 */
export function addVulnTag(vulnId, tag) {
  return axios.post(`${API_URL}/vuln/add_tag`, {
    vulnId: vulnId,
    tag: tag
  })
}

/**
 * 删除漏洞标签
 * @param {number} vulnId - 漏洞ID
 * @param {string} tag - 标签内容
 * @returns {Promise} - Axios Promise
 */
export function deleteVulnTag(vulnId, tag) {
  return axios.post(`${API_URL}/vuln/delete_tag`, {
    vulnId: vulnId,
    tag: tag
  })
}

/**
 * 查询所有不重复的标签
 * @returns {Promise} - Axios Promise
 */
export function getAllDistinctTags() {
  return axios.get(`${API_URL}/vuln/all_tags`)
}